apiVersion: batch/v1
kind: Job
metadata:
  name: <%= @options[:job] %>
  namespace: <%= @options[:app] %>
  labels:
    app.kubernetes.io/name: <%= @options[:app] %>
    app.kubernetes.io/version: <%= @options[:release] %>
    app.kubernetes.io/managed-by: cuber
spec:
  template:
    spec:
      containers:
      - name: job-proc
        image: <%= @options[:image] %>:<%= @options[:release] %>
        imagePullPolicy: Always
        command: <%= @options[:job_cmd] %>
        envFrom:
        - configMapRef:
            name: env
        - secretRef:
            name: app-secrets
      imagePullSecrets:
      - name: regcred
      restartPolicy: Never
  backoffLimit: 0
